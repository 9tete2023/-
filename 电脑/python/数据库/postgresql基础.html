<!DOCTYPE html>
<html lang="zh">
<head>
<title>精通PostgreSQL</title>
<!-- 2015-12-03 17:40 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="万泽(德山书生)">
<meta  name="description" content="制作者邮箱：a358003542@gmail.com"
>
<style type="text/css"> /*
 * with_bootstrap.css
 *
 * Copyright 2015 wanze <a358003542@gmail.com>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
 * MA 02110-1301, USA.
 *
 *
 */

@import url("http://getbootstrap.com/dist/css/bootstrap.min.css");

/* Sticky footer styles
-------------------------------------------------- */
html {
    position: relative;
    min-height: 100%;
    margin: 0px;
}
body {
    /* Margin bottom by footer height */
    margin-bottom: 60px;
}
footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    /* Set the fixed height of the footer here */
    height: 60px;
    background-color: #f5f5f5;
}

/* Custom page CSS
-------------------------------------------------- */
/* Not required for template or sticky footer method. */

.container {
  width: auto;
  max-width: 750px;
  padding: 0 15px;
}
.container .text-muted {
  margin: 20px 0;
}

/* background-color: #f8f8f8; */
.navbar-default{
    background-color: #fff;
}
/*--------------------*/

#content{
    margin: 0 auto;
    max-width: 750px;
    padding: 17px;
    line-height:160%;
    font-size:16px;
}

h1,h2,h3,h4,h5,h6 {
    font-family: 'PT Sans Narrow', sans-serif;
    font-weight: 700;
    margin-bottom: 1em;
    margin-top: 1em;
}


pre{line-height:180%;font-size:90%;}
code,kbd,pre,samp {
  font-family: monospace, serif;
}

code{  padding: 2px;}
p{
    text-indent:2em;/*段落缩进*/
    line-height:180%;/*行间距*/
    }

.title{
    text-align: center;
}
.org-ol li , .org-ul li , org-dl dt{
    margin-top: 0.5em; /*增大li之间的垂直space*/
    margin-bottom: 0.5em; /*增大li之间的垂直space*/
}
p.verse{
    margin-left: 3%;
    text-indent:0em;
}

.right{
    margin-left: auto;
    margin-right: 0px;
    text-align: right;
}
.left{
    margin-left: 0px;
    margin-right: auto;
    text-align: left;
}
.center{
    margin-left: auto;
    margin-right: auto;
    text-align: center;
}

.underline{
    text-decoration: underline;
}


video{
    width: 750px;
    margin-left: auto;
    margin-right: auto;
}

figure p{
    text-indent:0em;/*段落缩进*/
}
img{
    max-width: 700px;
}

figure{
    text-align: center;
}

table, th, td
{
    margin:0 auto;
    min-width:2em;
    text-align:center ;
    padding: 5px;
}

table{
    border-top: 2px solid ;
    border-bottom: 2px solid ;
}
thead{
    border-bottom: 1px solid ;
}

/*  class  */
.framed{
    max-width:700px;
    border:1px solid ;
    padding: 1em;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}

.notecard{
    width: 320px;
    position:relative;
    right: -215px;
    padding: 1em;
    margin:0 auto;
    border: solid 1px;
    -webkit-box-sizing: border-box;
    -moz-box-sizing: border-box;
    box-sizing: border-box;
}

/*
http://thomasf.github.io/solarized-css/
*/

dfn {
  font-style: italic;
}
dd{
    margin-left:2em;
}
mark {
  background: #ff0;
  color: #000;
}

q {
  quotes: "\201C" "\201D" "\2018" "\2019";
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}

table {
  border-collapse: collapse;
  border-spacing: 0;
}



.tag {
  background-color: #eee8d5;
  color: #d33682;
  padding: 0 0.2em;
}


.todo,
.next,
.done {
  color: #fdf6e3;
  background-color: #dc322f;
  padding: 0 0.2em;
}
.tag {
  -webkit-border-radius: 0.35em;
  -moz-border-radius: 0.35em;
  border-radius: 0.35em;
}
.TODO {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #2aa198;
}
.NEXT {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #268bd2;
}
.ACTIVE {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #268bd2;
}
.DONE {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #859900;
}
.WAITING {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #cb4b16;
}
.HOLD {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #d33682;
}
.NOTE {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #d33682;
}
.CANCELLED {
  -webkit-border-radius: 0.2em;
  -moz-border-radius: 0.2em;
  border-radius: 0.2em;
  background-color: #859900;
}


/*
pygmentize -f html -S colorful -a .highlight
*/

.highlight .hll { background-color: #ffffcc }
.highlight  { background: #ffffff; }
.highlight .c { color: #888888 } /* Comment */
.highlight .err { color: #FF0000; background-color: #FFAAAA } /* Error */
.highlight .k { color: #008800; font-weight: bold } /* Keyword */
.highlight .o { color: #333333 } /* Operator */
.highlight .cm { color: #888888 } /* Comment.Multiline */
.highlight .cp { color: #557799 } /* Comment.Preproc */
.highlight .c1 { color: #888888 } /* Comment.Single */
.highlight .cs { color: #cc0000; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #c65d09; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008800; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008800; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008800; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #003388; font-weight: bold } /* Keyword.Pseudo */
.highlight .kr { color: #008800; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #333399; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #6600EE; font-weight: bold } /* Literal.Number */
.highlight .s { background-color: #fff0f0 } /* Literal.String */
.highlight .na { color: #0000CC } /* Name.Attribute */
.highlight .nb { color: #007020 } /* Name.Builtin */
.highlight .nc { color: #BB0066; font-weight: bold } /* Name.Class */
.highlight .no { color: #003366; font-weight: bold } /* Name.Constant */
.highlight .nd { color: #555555; font-weight: bold } /* Name.Decorator */
.highlight .ni { color: #880000; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #FF0000; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0066BB; font-weight: bold } /* Name.Function */
.highlight .nl { color: #997700; font-weight: bold } /* Name.Label */
.highlight .nn { color: #0e84b5; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #007700 } /* Name.Tag */
.highlight .nv { color: #996633 } /* Name.Variable */
.highlight .ow { color: #000000; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #6600EE; font-weight: bold } /* Literal.Number.Bin */
.highlight .mf { color: #6600EE; font-weight: bold } /* Literal.Number.Float */
.highlight .mh { color: #005588; font-weight: bold } /* Literal.Number.Hex */
.highlight .mi { color: #0000DD; font-weight: bold } /* Literal.Number.Integer */
.highlight .mo { color: #4400EE; font-weight: bold } /* Literal.Number.Oct */
.highlight .sb { background-color: #fff0f0 } /* Literal.String.Backtick */
.highlight .sc { color: #0044DD } /* Literal.String.Char */
.highlight .sd { color: #DD4422 } /* Literal.String.Doc */
.highlight .s2 { background-color: #fff0f0 } /* Literal.String.Double */
.highlight .se { color: #666666; font-weight: bold; background-color: #fff0f0 } /* Literal.String.Escape */
.highlight .sh { background-color: #fff0f0 } /* Literal.String.Heredoc */
.highlight .si { background-color: #eeeeee } /* Literal.String.Interpol */
.highlight .sx { color: #DD2200; background-color: #fff0f0 } /* Literal.String.Other */
.highlight .sr { color: #000000; background-color: #fff0ff } /* Literal.String.Regex */
.highlight .s1 { background-color: #fff0f0 } /* Literal.String.Single */
.highlight .ss { color: #AA6600 } /* Literal.String.Symbol */
.highlight .bp { color: #007020 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #336699 } /* Name.Variable.Class */
.highlight .vg { color: #dd7700; font-weight: bold } /* Name.Variable.Global */
.highlight .vi { color: #3333BB } /* Name.Variable.Instance */
.highlight .il { color: #0000DD; font-weight: bold } /* Literal.Number.Integer.Long */

 </style>
</head>
<body>
<header class="header">
<nav class="navbar navbar-default navbar-static-top"><div class="container">
<div class="navbar-header">
<a class="navbar-brand" href="http://www.cdwanze.org"><img style="max-width:50px; margin-top: -15px;" src="/templates/images/logo.svg" /></a></div>
<div id="navbar">
<ul class="nav navbar-nav"><li class="active"><a href="http://blog.cdwanze.org">博客</a><li><a href="http://blog.cdwanze.org/about.html">关于</a><li><a href="http://blog.cdwanze.org/donate.html">支持</a></div>
</div>
</nav></header><div id="content">
<h1 class="title">精通PostgreSQL</h1>
<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. 前言</a>
<ul>
<li><a href="#sec-1-1">1.1. 安装postgresql</a></li>
</ul>
</li>
<li><a href="#sec-2">2. 用户群组权限管理</a>
<ul>
<li><a href="#sec-2-1">2.1. 修改postgres的密码</a></li>
<li><a href="#sec-2-2">2.2. postgres这个用户的其他信息</a></li>
<li><a href="#sec-2-3">2.3. 查看当前有多少用户</a></li>
<li><a href="#sec-2-4">2.4. 新建用户</a></li>
<li><a href="#sec-2-5">2.5. 删除用户</a></li>
<li><a href="#sec-2-6">2.6. 改变用户的权限</a></li>
<li><a href="#sec-2-7">2.7. 改变用户密码</a></li>
<li><a href="#sec-2-8">2.8. 新建一个群组</a></li>
</ul>
</li>
<li><a href="#sec-3">3. 使用工具初探</a>
<ul>
<li><a href="#sec-3-1">3.1. psql</a></li>
<li><a href="#sec-3-2">3.2. pgadmin3</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1. 安装</a></li>
<li><a href="#sec-3-2-2">3.2.2. 连接服务器</a></li>
<li><a href="#sec-3-2-3">3.2.3. 图形化查询</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sec-4">4. 第一个例子</a>
<ul>
<li><a href="#sec-4-1">4.1. 创建数据库</a></li>
<li><a href="#sec-4-2">4.2. 备份和还原</a></li>
<li><a href="#sec-4-3">4.3. 改变某个数据库的所有者</a></li>
<li><a href="#sec-4-4">4.4. postgresql字段数据类型</a></li>
</ul>
</li>
<li><a href="#sec-5">5. 附录</a>
<ul>
<li><a href="#sec-5-1">5.1. 配置文件在那里</a></li>
<li><a href="#sec-5-2">5.2. 重启postgresql服务</a></li>
</ul>
</li>
<li><a href="#sec-6">6. 参考资料</a></li>
</ul>
</div>
</nav>



<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> 前言</h2>
<div class="outline-text-2" id="text-1">
<p>
本文是在 <a href="sql数据库入门.html">sql数据库入门</a> 一文基础之上的，一些基本的SQL概念将不会再赘述了。PostgreSQL是很有名的一个开源数据库，最初由加州大学伯克利分校的计算机系开发。有名的openerp框架使用的就是postgresql数据库，其内在也继承了postgresql的client/server模型。
</p>
</div>


<div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> 安装postgresql</h3>
<div class="outline-text-3" id="text-1-1">
<p>
在ubuntu下可以这样简单安装之：
</p>
<div class="highlight"><pre>sudo  apt-get install postgresql
</pre></div>

<p>
但是这样安装之后，你需要牢记一点的是，新安装的PostgreSQL数据库还只有 <strong>postgres</strong> 这个用户有新建role（或说用户）和新建数据库的权限。你需要通过postgres这个用户来执行 <code>createuser</code> 或 <code>createdb</code> 命令。这里我们先不急着学习SQL语句，因为postgresql里面关于用户群组权限的设置稍微有点复杂，而要使用postgresql，这一块是必须有个基本的了解的。
</p>
</div>
</div>
</div>



<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> 用户群组权限管理</h2>
<div class="outline-text-2" id="text-2">
<p>
postgresql处理我们通常所谓的登录用户或者其他用户概念的术语是Rules（英文的意思是一系列的规则），后面都称之为用户（rules），可以理解为为这个用户确立的一系列访问修改数据库的规则。然后rules是可以包含其他rules的，这个包含其他rules的rules我们通常称之为群组（group rules），然后群组也可以包含群组，但一般都推荐简单分为用户（rules）和群组用户（group rules）这两类。然后用户如果有登录权限的话则可以称之为登录用户（login rules），群组用户也可以赋予登录权限，但处于简单的考虑没谁这么做。所以现在rules简单的划分就分为这三类:
</p>

<ol class="org-ol">
<li>一般用户，这里主要指没有登录权限的一般用户。
</li>
<li>登录用户，或叫做一般登录用户，其属于一般用户，但没有登录权限。
</li>
<li>群组用户，包含一般用户的rules。
</li>
</ol>

<p>
此外postgresql还提供 <strong>superuser</strong> 超级用户这一类型，其默认不能登录（更确切的说是不可以连接，也不能通过psql来连接。），但对于数据库几乎拥有所有的权限——比如创建数据库，创建用户，对于数据库的查增删改等。实际上superuser也可以加上 <code>login</code> 属性，但非常不推荐这么做，最好是不使用超级用户，而是对于具体的用户具体的数据库权限进行分配。
</p>

<p>
默认创建的postgres这个用户是可以连接的，而且我们看到其至少对postgres这个数据库具有所有权限，但是我还不太确定其是不是superuser，因为其可能对其他数据库并没有权限，这个后面再谈。按照 <a href="http://serverfault.com/questions/110154/whats-the-default-superuser-username-password-for-postgres-after-a-new-install">这篇网页</a> 的描述，系统默认自建的postgres这个用户最好也在系统中锁定:
</p>
<pre class="example">
passwd -l postgres
</pre>

<p>
这样你就不能通过 <code>login</code> 登录进去了，而只能通过TCP/IP的方式来登入postgresql数据库了。然后推荐如下通过sudo命令以postgres身份来连接postgres数据库。
</p>
</div>

<div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> 修改postgres的密码</h3>
<div class="outline-text-3" id="text-2-1">
<pre class="example">
sudo -u postgres psql postgres

postgres=# \password postgres
Enter new password: 
Enter it again:
</pre>

<p>
这里需要强调一点的是这里通过psql来进行连接（postgres）然后输入 <code>\password</code> 修改postgres的密码是具体通过 TCP/IP 方式连接postgresql数据库的密码，不是系统passwd管理的那个密码。
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> postgres这个用户的其他信息</h3>
<div class="outline-text-3" id="text-2-2">
<p>
postgres这个用户的一些信息如下所示:
</p>
<pre class="example">
postgres:x:121:131:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash
</pre>
<p>
然后还有新建的postgres这个群组:
</p>
<pre class="example">
postgres:x:131:
</pre>

<p>
这里的121是uid，131是gid，然后后面 <code>/var/lib/postgresql</code> 这个文件夹就是postgres该用户的主文件夹。你可能会遇到保存 <code>.psql_history</code> 这个文件的权限问题，参看 <a href="http://dba.stackexchange.com/questions/68705/could-not-save-history-to-file-var-lib-postgresql-psql-history-no-such-file">这个网页</a> ，这个时候需要确认该文件夹的所有用户和所有群组都是postgres。
</p>
</div>
</div>


<div id="outline-container-sec-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> 查看当前有多少用户</h3>
<div class="outline-text-3" id="text-2-3">
<p>
按照 <a href="http://stackoverflow.com/questions/32151288/how-is-there-a-pg-roles-table-in-postgres-before-a-database-is-created">这篇网页</a> 的介绍， <code>pg_roles</code> 是一个view视图，其只是一个对 <code>pg_authid</code> 的简单可读的视图封装，如下面所示，两者目前来说没有差异，然后我们看到postgres其是为superuser，也是login user。
</p>

<pre class="example">
select rolname,rolsuper,rolcreaterole,rolcreatedb,rolcanlogin from pg_roles;

 rolname  | rolsuper | rolcreaterole | rolcreatedb | rolcanlogin 
----------+----------+---------------+-------------+-------------
 postgres | t        | t             | t           | t
</pre>

<pre class="example">
select rolname,rolsuper,rolcreaterole,rolcreatedb,rolcanlogin from pg_authid;

 rolname  | rolsuper | rolcreaterole | rolcreatedb | rolcanlogin 
----------+----------+---------------+-------------+-------------
 postgres | t        | t             | t           | t
</pre>
</div>
</div>


<div id="outline-container-sec-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> 新建用户</h3>
<div class="outline-text-3" id="text-2-4">
<p>
新建一个用户:
</p>
<pre class="example">
create role the_name;
</pre>
<p>
但最起码要有登录login权限吧:
</p>
<pre class="example">
create role the_name login;
</pre>

<p>
在使用postgresql时，如果某个用户不存在，那么PostgreSQL将会报错: 
</p>
<pre class="example">
createdb: could not connect to database template1: FATAL:  role "wanze" does not exist
</pre>
</div>
</div>



<div id="outline-container-sec-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> 删除用户</h3>
<div class="outline-text-3" id="text-2-5">
<pre class="example">
drop role the_name;
</pre>

<p>
或者该用户名不存在也不会报错的写法:
</p>
<pre class="example">
drop role if exists the_name;
</pre>
</div>
</div>



<div id="outline-container-sec-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> 改变用户的权限</h3>
<div class="outline-text-3" id="text-2-6">
<p>
如下所示就改变一个用户的权限了。
</p>
<pre class="example">
alter role the_name createdb;
</pre>

<p>
参照手册，后面的关键词有:
</p>
<pre class="example">
SUPERUSER | NOSUPERUSER
CREATEDB | NOCREATEDB
CREATEROLE | NOCREATEROLE
CREATEUSER | NOCREATEUSER
INHERIT | NOINHERIT
LOGIN | NOLOGIN
REPLICATION | NOREPLICATION
</pre>
</div>
</div>

<div id="outline-container-sec-2-7" class="outline-3">
<h3 id="sec-2-7"><span class="section-number-3">2.7</span> 改变用户密码</h3>
<div class="outline-text-3" id="text-2-7">
<p>
在新建用户的时候，我们可以如下:
</p>
<pre class="example">
create role the_name password "the_password";
</pre>

<p>
后面也可以通过 <code>alter role</code> 来:
</p>
<pre class="example">
alter role the_name password "the_password";
</pre>




<hr >
</div>
</div>
<div id="outline-container-sec-2-8" class="outline-3">
<h3 id="sec-2-8"><span class="section-number-3">2.8</span> 新建一个群组</h3>
<div class="outline-text-3" id="text-2-8">
<pre class="example">
CREATE ROLE royalty INHERIT;
</pre>


<p>
给群组用户增加登录用户
</p>
<pre class="example">
GRANT royalty TO leo;
GRANT royalty TO regina;
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> 使用工具初探</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> psql</h3>
<div class="outline-text-3" id="text-3-1">
<p>
这里参考了 <a href="http://dba.stackexchange.com/questions/1285/how-do-i-list-all-databases-and-tables-using-psql">这个网页</a> 。
</p>
<dl class="org-dl">
<dt> <code>\l</code> 或 <code>\list</code> </dt><dd>列出所有的数据库
</dd>
<dt> <code>\du</code> </dt><dd>列出所有的用户
</dd>
<dt> <code>\dt *</code> </dt><dd>列出当前数据库所有的表格
</dd>
<dt> <code>\c</code> 或者 <code>\connect</code> </dt><dd>切换数据库
</dd>
</dl>
</div>
</div>





<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> pgadmin3</h3>
<div class="outline-text-3" id="text-3-2">
<p>
pgadmin3是针对PostgreSQL数据库很有名的一个管理员工具，里面的经很多，这里只是简单谈论一下。
</p>
</div>

<div id="outline-container-sec-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> 安装</h4>
<div class="outline-text-4" id="text-3-2-1">
<p>
在ubuntu下可以用apt-get简单安装之。
</p>
<div class="highlight"><pre>sudo apt-get install pgadmin3
</pre></div>
</div>
</div>

<div id="outline-container-sec-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> 连接服务器</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
刚进入软件需要连接服务器，如下图所示:
</p>


<figure>
<p><img src="images/pgadmin3连接服务器.png" alt="pgadmin3连接服务器.png">
</p>
<figcaption><span class="figure-number">Figure 1:</span> pgadmin3连接服务器</figcaption>
</figure>

<p>
目前我已经确认的就是名称随意填，然后主机不能填127.0.0.1，而只能填"localhost"这个字符串。然后后面的应该不用更改什么了，如果你给你的postgres数据库设置密码了，那么这个密码也需要填上。
</p>

<p>
连接好服务器了，我们就可以双击或点击查看你的PostgreSQL数据库的信息了。
</p>
</div>
</div>

<div id="outline-container-sec-3-2-3" class="outline-4">
<h4 id="sec-3-2-3"><span class="section-number-4">3.2.3</span> 图形化查询</h4>
<div class="outline-text-4" id="text-3-2-3">
<p>
在工具那里有很多有用的工具，比如查看服务器状态工具等。然后我们点击查询工具，会弹出一个窗口，看到图形化查询那个子选单，如下图所示:
</p>


<figure>
<p><img src="images/pgadmin3图形化查询.png" alt="pgadmin3图形化查询.png">
</p>
<figcaption><span class="figure-number">Figure 2:</span> pgadmin3图形化查询</figcaption>
</figure>

<p>
这里我找到了前面我们新建的那个fruits模型，可以看到所有的fruits模型是放在一个名字叫做 <code>mymodule_fruits</code> 的SQL表格里的。然后它的表头有:id, create_uid, create_date, name等。
</p>

<p>
然后我们切换到SQL编辑器子选单。这个工具会根据你的图形化查询选择结果自动生成对应的SQL查询语句:
</p>
<pre class="example">
SELECT 
  * 
FROM 
  public.mymodule_fruits;
</pre>

<p>
所以在我们这个odoo数据库里面，我们新建的模型fruits的各个对象，具体存入的table名是 <code>public.mymodule_fruits</code> 。
</p>

<p>
然后我们点击 查询→执行 ，来具体执行这个SQL语句，输出结果如下所示:
</p>


<figure>
<p><img src="images/pgadmin3具体查询结果.png" alt="pgadmin3具体查询结果.png">
</p>
</figure>
</div>
</div>
</div>
</div>




<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> 第一个例子</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> 创建数据库</h3>
<div class="outline-text-3" id="text-4-1">
<pre class="example">
CREATE DATABASE mydb;
</pre>
<p>
有 CREATEDB 权限的用户可以新建数据库。
</p>


<p>
然后创建一个数据库，并指定这个数据库的owner。
</p>
<pre class="example">
CREATE DATABASE mydb WITH owner = mydb_admin;
</pre>


<p>
然后以mydb_admin登录开始进行数据库的其他操作。
</p>
</div>
</div>


<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> 备份和还原</h3>
<div class="outline-text-3" id="text-4-2">
<p>
两个backup方法  pg_dump 和 pg_dumpall
用pg_restore 来还原，
</p>
</div>
</div>




<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> 改变某个数据库的所有者</h3>
<div class="outline-text-3" id="text-4-3">
<p>
首先你需要以postgres的身份连接postgres数据库，因为你要进行更改某个数据库的所有者，就必须是目前该数据库的所有者。
</p>
<pre class="example">
wanze@wanze-ubuntu:~$ sudo -u postgres psql postgres
psql (9.3.8)
Type "help" for help.

postgres=# ALTER DATABASE mydb OWNER TO learner;
ALTER DATABASE
postgres=# \q
</pre>

<p>
这里ALTER DATABASE语句里面 mydb 是具体你要更改的数据库名字，然后后面的learner是具体更改为的所有者名字。
</p>


<p>
类似上面谈及的，还有 <strong>dropdb</strong> 用于删除数据库， <strong>dropuser</strong> 用于删除用户。
</p>


<p>
CREATE TABLE语句我们都熟悉了，不过具体到数据类型上，还需要详细讨论一番。
</p>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> postgresql字段数据类型</h3>
<div class="outline-text-3" id="text-4-4">
<p>
int , smallint , real , double precision ,
char( N ) , varchar( N ) , date , time , timestamp , and interval ,
</p>



<p>
而postgresql支持的数据类型就多了，有：int，smallint，real，boolean，date，time，integer，text，char(N)，varchar(N) 甚至还有json。这个可以后面慢慢了解，更多细节请具体参看官方文档第八章 Data Types，这是 <a href="http://www.postgresql.org/docs/9.3/static/datatype.html">版本9.3的网页链接</a> 。
</p>

<p>
其中对于整数简单的就用integer，字符串简单的就用text，然后小数简单的就用real，布尔值就用boolean，此外还有一些特殊用途的数据类型值得引起我们的注意，如uuid，json，arrays，money，bytea，还有日期和时间的date，time；几何类型支持的point，line等等，
</p>



<pre class="example">
INSERT INTO weather VALUES (’San Francisco’, 46, 50, 0.25, ’1994-11-27’);
</pre>

<pre class="example">
COPY weather FROM ’/home/user/weather.txt’;
</pre>

<pre class="example">
SELECT city, (temp_hi+temp_lo)/2 AS temp_avg, date FROM weather;
</pre>


<p>
SELECT *
    FROM weather , cities
    WHERE city=name;
</p>




<p>
CURRENT_DATE 目前的日期 可用于默认值。
</p>

<p>
CURRENT_TIME
</p>
</div>
</div>
</div>








<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> 附录</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> 配置文件在那里</h3>
<div class="outline-text-3" id="text-5-1">
<pre class="example">
sudo -u postgres psql postgres

psql&gt; SELECT name,setting FROM pg_settings WHERE category = 'File Locations';
       name        |                 setting                  
-------------------+------------------------------------------
 config_file       | /etc/postgresql/9.3/main/postgresql.conf
 data_directory    | /var/lib/postgresql/9.3/main
 external_pid_file | /var/run/postgresql/9.3-main.pid
 hba_file          | /etc/postgresql/9.3/main/pg_hba.conf
 ident_file        | /etc/postgresql/9.3/main/pg_ident.conf
(5 rows)
</pre>

<p>
但这些配置文件初级用户还不需要太关心。
</p>
</div>
</div>




<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> 重启postgresql服务</h3>
<div class="outline-text-3" id="text-5-2">
<p>
在linux下可以运行如下命令行来达到目的:
</p>
<pre class="example">
sudo service postgresql restart
</pre>

<p>
或者
</p>

<pre class="example">
sudo service postgresql reload
</pre>
</div>
</div>
</div>


<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 参考资料</h2>
<div class="outline-text-2" id="text-6">
<ol class="org-ol">
<li>PostgreSQL官方参考文档
</li>
<li>PostgreSQL Up and Running, 2nd Edition 
</li>
</ol>
</div>
</div>
</div>
<footer class="footer">
<div class="container">
<p class="text-muted">作者: 万泽(德山书生); 编者: wanze(<a href="mailto:a358003542@163.com">a358003542@163.com</a>); 最后修改时间: 2015-12-03 17:40.</p></div>
</body>
</html>
